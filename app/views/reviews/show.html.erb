<div class="row">
  <div class="row">
    <div class="col-md-9">
      <h3><%= link_to @review.user.name, @review.user %>'s Review >
      <%= link_to @review.book.title, @review.book %></h3>
    </div>
    <div class="col-md-2">
      <h4>
        <% if current_user.admin? %>
          <%= link_to t("delete"), review_path(@review),
            method: :delete, data: {confirm: t("confirm")}, class: "btn btn-danger"%>
        <% elsif current_user.current_user? @review.user %>
          <%= link_to t("edit"), edit_review_path(@review), class: "btn btn-success" %>
          <%= link_to t("delete"), @review, method: :delete,
            data: {confirm: t("confirm")}, class: "btn btn-danger" %>
        <% else %>
          <i class="fa fa-flag" aria-hidden="true"></i>
          <%= link_to "Report", "#", {:remote => true, 'data-toggle' =>  "modal", 'data-target' => '#modal-report'} %>
        <% end %>
      </h4>
      <div class="modal fade" id="modal-report" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Report</h4>
            </div>
            <div class="modal-body">
              <%= form_for @report, html: {method: :post} do |f| %>
                <%= f.hidden_field :review_id, value: @review.id %>
                <%= f.hidden_field :reported_user, value: @review.user.id %>

                <%= f.text_area :content, class: "form-control" %>
                <%= f.submit "Submit", class: "btn btn-primary" %>
              <% end %>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
  <br>

  <div class="col-md-2">
    <%= book_image_review @review.book %>
  </div>

  <div class="col-md-8">
    <%= raw @review.content %>
    <span class="timestamp">
      <%= t "posted_ago", time: time_ago_in_words(@review.created_at) %>
    </span>
    <div id="comment-<%= @review.id %>" class="col-md-12 collapse">
      <%= render "comments/form", review: @review %>
    </div>
    <div id="comment" class="col-md-10">
      <ul class="category">
        <% @review.comments.each do |comment| %>
          <li id="comment-<%= comment.id %>">
            <div><%= link_to comment.user.name, comment.user %></div>
            <div class="col-md-9"><%= comment.content %></div>
            <div class="col-md-3">
              <% if current_user.current_user? comment.user %>
                <a data-toggle="collapse" href="#form-<%= comment.id %>"><%= t "edit" %></a>
                <%= t "divide" %>
                <%= link_to t("delete"), comment_path(comment), method: :delete,
                  data: {confirm: t("confirm")}, remote: true %>
              <% end %>
            </div>
            <span class="timestamp">
              <%= t "posted_ago", time: time_ago_in_words(comment.created_at) %>
            </span>
            <div id="form-<%= comment.id %>" class="col-md-12 collapse">
              <%= form_for comment, html: {method: :put}, remote: true do |f| %>
                <%= f.hidden_field :review_id, value: @review.id %>
                <div class="col-md-10"><%= f.text_field :content, class: "form-control" %></div>
                <div class="col-md-2"><%= f.submit t("comment") %></div>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</div>
